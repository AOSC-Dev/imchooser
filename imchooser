# Usage: imchooser [ fcitx / ibus / scim ]

case $1 in
fcitx)
  echo "Selecting fcitx..."
  # Necesity for GNOME Shell.
  gsettings set org.gnome.settings-daemon.plugins.keyboard active false
  echo "Please go to https://extensions.gnome.org and install KIMPanel for Fcitx to work."
  IM=fcitx
  ;;
ibus)
  echo "Selecting ibus..."
  gsettings set org.gnome.settings-daemon.plugins.keyboard active true
  IM=ibus
  ;;
scim)
  echo "Selecting scim..."
  # Necesity for GNOME Shell.
  gsettings set org.gnome.settings-daemon.plugins.keyboard active false
  echo "Please go to https://extensions.gnome.org and install KIMPanel for Fcitx to work."
  IM=scim
  ;;
*)
  echo "Invalid choice!"
  exit 1
  ;;
esac

echo $IM | tee $HOME/.im > /dev/null

rm -f ~/.imchooser || true

IMCHOSEN=`cat ~/.im`

echo export GTK_IM_MODULE=$IMCHOSEN > ~/.xprofile
echo export GTK_IM_MODULE=$IMCHOSEN > ~/.xinitrc
echo export QT_IM_MODULE=$IMCHOSEN >> ~/.xprofile
echo export QT_IM_MODULE=$IMCHOSEN >> ~/.xinitrc
echo export QT5_IM_MODULE=$IMCHOSEN >> ~/.xprofile
echo export QT5_IM_MODULE=$IMCHOSEN >> ~/.xinitrc
echo export XMODIFIERS=@im=$IMCHOSEN >> ~/.xprofile
echo export XMODIFIERS=@im=$IMCHOSEN >> ~/.xinitrc
